---
title: 'O2SS0239：無法存取 ROWID 資料行 (錯誤) '
description: 描述 SQL Server 移轉小幫手 (SSMA) for Oracle 需要定義 ROWID 資料行的原因。
author: nahk-ivanov
ms.prod: sql
ms.technology: ssma
ms.devlang: sql
ms.topic: article
ms.date: 10/15/2020
ms.author: alexiva
ms.openlocfilehash: 934d4e27e35d1ba8893d40ed07d790af464cf48c
ms.sourcegitcommit: 757b827cf322c9f792f05915ff3450e95ba7a58a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/16/2020
ms.locfileid: "92137519"
---
# <a name="o2ss0239-rowid-column-not-accessible-error"></a>O2SS0239： `ROWID` 無法存取資料行 (錯誤) 

本文說明 SQL Server 移轉小幫手 (SSMA) for Oracle 需要 `ROWID` 針對含有觸發程式的資料表定義資料行的原因。

## <a name="background"></a>背景

在 Oracle 中，您可以建立將執行的觸發程式 `FOR EACH ROW` ，而不是變更整個資料列集。 在 SQL Server 觸發程式一律會針對整個修改過的資料列集執行。 如果資料列層級 Oracle 觸發程式同時存取 `:old` 和 `:new` 特殊變數，則 SSMA 需要一種方式來比對兩個數據列集的資料列，以識別在更新之前和之後的指定資料列的值。 為了模擬這類「每個資料列」的功能，SSMA 會加入特殊 `ROWID` 的資料行來唯一識別每個修改過的資料列，並使用它來建立 `inserted` 和資料列集之間的關聯性 `deleted` 。

此行為是由 [**產生 ROWID 資料行**] 專案設定所控制，您可以在 [**工具**  -  **專案設定**  -  **一般**  -  **轉換**  -  **產生**] 底下找到此設定。 如果設定為 [ **否**]，則不會將資料 `ROWID` 行加入至資料表，且 SSMA 將無法轉換這類觸發程式。

## <a name="example"></a>範例

請考慮下列 Oracle 觸發程式，此觸發程式會針對資料表中更新的每個資料列執行 `TRIG_TEST` ：

```sql
CREATE OR REPLACE TRIGGER TSCHM.TRIG_TEST_AU
AFTER UPDATE OF DATA ON TSCHM.TRIG_TEST
FOR EACH ROW
BEGIN
    IF (:new.DATA = 'ABC') THEN
        INSERT INTO TSCHM.TRIG_TEST(DATA) VALUES ('-' || :old.DATA);
    END IF;
END;
```

當您嘗試在 SSMA 中轉換此觸發程式時，如果 [ **產生 ROWID 資料行** ] 專案設定設為 [ **否**]，則 SSMA 會產生下列錯誤訊息：

> O2SS0239：無法存取 ROWID 資料行

## <a name="possible-remedies"></a>可能的補救措施

變更 [ **產生 ROWID 資料行** ] 專案設定，以 **針對具有觸發程式的資料表加入 [rowid] 資料行**，如此可讓 SSMA 在轉換上述範例時，于 SQL Server 觸發程式內產生下列 t-sql：

1) 在資料列集上執行資料指標 `inserted` ， `ROWID` 並 `DATA` 在 `@new$0` 和變數中選取和資料行 `@new$DATA` ：

    ```sql
    DECLARE
        ForEachInsertedRowTriggerCursor CURSOR LOCAL FORWARD_ONLY READ_ONLY FOR
        SELECT ROWID, DATA
        FROM inserted

    OPEN ForEachInsertedRowTriggerCursor

    FETCH ForEachInsertedRowTriggerCursor
        INTO @new$0, @new$DATA
    ```

2) `deleted` `@old$0` `@old$DATA` 根據插入的 `ROWID` (儲存在變數) 中，從資料列集的資料列集合到和變數中選取相符的資料列 `@new$0` ：

    ```sql
    SELECT @old$0 = ROWID, @old$DATA = DATA
    FROM deleted
    WHERE ROWID = @new$0
    ```

3) 使用變數執行觸發程式動作 `@old$DATA` / `@new$DATA` ：

    ```sql
    IF (@new$DATA = 'ABC')
        INSERT SSMAADMIN.TRIG_TEST(DATA)
        VALUES (('-' + ISNULL(@old$DATA, '')))
    ```

## <a name="related-conversion-messages"></a>相關的轉換訊息

* [O2SS0028：已產生 ROWID 資料行](o2ss0028.md)
* O2SS0267： ROWID 資料行
* O2SS0404：不能轉換 ROWID 資料行
